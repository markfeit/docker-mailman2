#!/bin/sh -e
#
# Run Mailman
#

export PATH="/usr/lib/mailman/bin:${PATH}"

mailman-update-cfg

install -m644 -o root -g root /usr/lib/mailman/cron/crontab.in /etc/cron.d/mailman
touch /var/log/mailman/error
chown mailman:mailman /var/log/mailman/error
chmod 660 /var/log/mailman/error

mailmanctl -s start

# TODO: Wait for Mailman to exit

ExecStop=/usr/lib/mailman/bin/mailman-update-cfg
ExecStop=/usr/lib/mailman/bin/mailmanctl stop

cat > /etc/cron.d/mailman <<EOF
# DO NOT EDIT THIS FILE!
#
# Contents of this file managed by mailman
# Master copy is /usr/lib/mailman/cron/crontab.in
EOF
